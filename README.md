# Pixel Apocalypse

ヴァンパイアサバイバー風のWebゲーム - 実世界マップ対応版

## 概要
HTML5 CanvasとJavaScriptで作られた2Dアクションサバイバルゲームです。
OpenStreetMapを使用した実在の街を舞台に、スタート地点からゴール地点まで、敵の大群から生き延びながら進むサバイバルゲームです。

## 遊び方

### 操作方法
- **移動**: WASD キーまたは矢印キー（8方向移動）
- **攻撃**: 自動攻撃（プレイヤーの周囲に攻撃判定が発生）
- **目標**: スタート地点からゴール地点まで生き延びる

### ゲームの流れ
1. **ルート選択**: プリセットルート（5種類）またはカスタムルートを選択
2. **武器選択**: 3種類の武器から1つを選択
3. **ゲーム開始**: 選択したルートのスタート地点からゲーム開始
4. 時間経過とともに敵が画面外からスポーンします
5. 敵を倒すと経験値を獲得し、レベルアップします
6. レベルアップ時に3つのパワーアップから1つを選択できます
7. 時間が経つほど敵の数が増え、難易度が上昇します
8. ゴール地点に到達するか、HPが0になるとゲーム終了です

### プリセットルート
- **渋谷 → 新宿** (3.5km) - 難易度: ★★☆☆☆
- **梅田 → 難波** (4.2km) - 難易度: ★★★☆☆
- **京都駅 → 清水寺** (2.8km) - 難易度: ★★☆☆☆
- **東京タワー → スカイツリー** (8.5km) - 難易度: ★★★★★
- **横浜駅 → 中華街** (3.2km) - 難易度: ★★☆☆☆

### カスタムルート
住所を入力して、好きな場所でプレイできます：
1. ルート選択画面で「カスタムルート」を選択
2. スタート地点とゴール地点の住所を入力
3. 自動的に距離・難易度・予想時間が計算されます

### パワーアップの種類
- **攻撃範囲拡大**: 武器の攻撃範囲が20%増加
- **攻撃速度アップ**: 攻撃のクールダウンが20%減少
- **移動速度アップ**: 移動速度が15%増加
- **最大HPアップ**: 最大HPが20増加し、HPが全回復
- **攻撃力アップ**: 武器のダメージが25%増加
- **遠距離武器追加**: 新しい遠距離攻撃武器を獲得

### 敵の種類
- **ノーマル（赤）**: バランスの取れた標準的な敵
- **高速（黄）**: 移動速度が速いが体力が少ない敵
- **タンク（紫）**: 移動速度が遅いが体力とダメージが高い敵

### 武器の種類
- **剣 (Sword)**: 近接武器 - 高ダメージ、狭い範囲
- **ブーメラン (Boomerang)**: 中距離武器 - 中ダメージ、中範囲
- **魔法弾 (Magic Bolt)**: 遠距離武器 - 低ダメージ、広範囲

### 死亡時の演出
ゲームオーバー時には、以下の情報が表示されます：
- **死亡地点の実景**: OpenStreetMapの静的地図画像
- **死亡地点の住所**: 逆ジオコーディングによる詳細な住所
- **詳細な統計情報**: 生存時間、倒した敵、レベル、移動距離、進捗率

## ローカルでの実行方法

### 方法1: 直接ファイルを開く
1. このリポジトリをクローンまたはダウンロード
2. `index.html` をブラウザで開く

```bash
git clone https://github.com/Yamada-Tech/vampire-survivor-game.git
cd vampire-survivor-game
# ブラウザで index.html を開く
```

### 方法2: ローカルサーバーを使用（推奨）
```bash
# Python 3 を使用する場合
python -m http.server 8000

# Node.js の http-server を使用する場合
npx http-server

# その後、ブラウザで http://localhost:8000 を開く
```

## 実装されている機能

### コアシステム
- ✅ requestAnimationFrame を使用した滑らかなゲームループ
- ✅ FPS管理とデルタタイム計算
- ✅ レスポンシブなCanvas表示

### OpenStreetMapベースの実世界マップシステム
- ✅ **5つのプリセットルート**: 日本の主要都市間のルート
- ✅ **カスタムルート機能**: 好きな住所でプレイ可能
- ✅ **OpenStreetMap タイル表示**: 実在の地図を背景に表示
- ✅ **ルート進捗管理**: ゴールまでの残り距離をリアルタイム表示
- ✅ **自動難易度計算**: 距離に基づいて難易度を自動算出
- ✅ **ジオコーディング**: 住所から座標を取得（Nominatim API）
- ✅ **逆ジオコーディング**: 座標から住所を取得（死亡地点表示）

### プレイヤーシステム
- ✅ WASD/矢印キーでの8方向移動
- ✅ HP、経験値、レベルのステータス管理
- ✅ 移動方向に応じたアニメーション
- ✅ ダメージを受けた時の無敵時間
- ✅ 実世界座標（緯度経度）への移動反映

### 敵システム
- ✅ 時間経過で敵が自動スポーン（画面外から出現）
- ✅ プレイヤーを追跡するAI
- ✅ 3種類の敵タイプ（速度、HP、ダメージが異なる）
- ✅ 時間経過による難易度上昇

### 戦闘システム
- ✅ プレイヤー周囲への自動攻撃（近接武器）
- ✅ 遠距離攻撃武器（パワーアップで獲得可能）
- ✅ 経験値獲得とレベルアップシステム
- ✅ レベルアップ時のパワーアップ選択
- ✅ 3種類の武器タイプ（剣、ブーメラン、魔法弾）

### UI要素
- ✅ HPバー（画面左上）
- ✅ 経験値バー（画面左上）
- ✅ レベル表示
- ✅ サバイバル時間表示
- ✅ **ルート進捗表示**: ゴールまでの残り距離と進捗バー
- ✅ レベルアップ時のパワーアップ選択画面
- ✅ **ルート選択画面**: プリセット・カスタムルート選択
- ✅ **武器選択画面**: ゲーム開始前の武器選択
- ✅ **拡張ゲームオーバー画面**: 死亡地点の地図と詳細統計
- ✅ リスタート機能とメニューに戻る機能

### ビジュアルエフェクト
- ✅ プレイヤー、敵を図形で表現
- ✅ 敵が倒された時のパーティクルエフェクト
- ✅ ダメージを受けた時の視覚的フィードバック
- ✅ 攻撃範囲の表示
- ✅ レトロでダークな雰囲気のデザイン

## 技術スタック
- HTML5 Canvas API
- バニラJavaScript (ES6+)
- クラスベースのオブジェクト指向設計
- レスポンシブデザイン

## ファイル構成
```
vampire-survivor-game/
├── index.html           # ゲーム画面とUI構造
├── style.css            # スタイリングとレイアウト
├── game.js              # ゲームロジックとクラス定義
├── config.js            # 設定ファイル（API設定、マップ設定等）
├── route-manager.js     # ルート選択・管理システム
├── road-system.js       # 道路データ管理システム
├── map-renderer.js      # OpenStreetMapタイル描画システム
├── death-screen.js      # 拡張死亡画面システム
├── data/
│   └── road-data.js     # プリセットルートの道路データ
└── README.md            # このファイル
```

## 使用している外部API

本ゲームは以下の無料APIを使用しています：

### OpenStreetMap Tile Server
- **用途**: 地図タイルの表示
- **URL**: https://tile.openstreetmap.org
- **負荷**: 低（タイルキャッシュあり）

### Nominatim API
- **用途**: 住所検索（ジオコーディング）と逆ジオコーディング
- **URL**: https://nominatim.openstreetmap.org
- **頻度**: カスタムルート設定時・死亡時のみ
- **負荷**: 極小（レート制限: 1秒間隔）

### OpenStreetMap Static Map
- **用途**: 死亡地点の静的地図画像
- **URL**: https://staticmap.openstreetmap.de
- **頻度**: 死亡時1回のみ

**注意**: これらのAPIは無料で提供されていますが、過度な使用を避けるため、適切なレート制限とキャッシュ機構を実装しています。

## ブラウザ対応
- Google Chrome（推奨）
- Mozilla Firefox
- Safari
- Microsoft Edge

最新版のモダンブラウザでの動作を推奨します。

## 今後の拡張予定
- [ ] Overpass APIでカスタムルートの詳細な道路データ取得
- [ ] 道路に沿った移動の実装
- [ ] より詳細な地図情報の表示
- [ ] さらに多様な敵タイプの追加
- [ ] 追加の武器バリエーション
- [ ] ボスエネミーの実装
- [ ] サウンドエフェクトとBGM
- [ ] ハイスコアシステム
- [ ] モバイル対応（タッチ操作）
- [ ] より高度なパーティクルエフェクト
- [ ] 複数言語対応

## ライセンス
このプロジェクトはオープンソースです。自由にご利用ください。

## 貢献
バグ報告や機能提案は Issue からお願いします。
プルリクエストも歓迎します！